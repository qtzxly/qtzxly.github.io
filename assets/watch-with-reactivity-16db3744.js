import{u as o,c as r,w as n,_ as t,o as c,a as s,d as a}from"./app-b266d4ec.js";const d=s("div",{class:"prose m-auto slide-enter-content"},[s("p",null,[s("div",{class:"table-of-contents"},[s("div",{class:"table-of-contents-anchor"},[s("div",{class:"i-ri-menu-2-fill"})]),s("ul",null,[s("li",null,[s("a",{href:"#understanding-vue-reactivity"},"Understanding @vue/reactivity "),s("ul",null,[s("li",null,[s("a",{href:"#computed"},"Computed ")])])]),s("li",null,[s("a",{href:"#effect"},"Effect ")]),s("li",null,[s("a",{href:"#build-yourself-a-watch"},"Build yourself a watch "),s("ul",null,[s("li",null,[s("a",{href:"#the-basic"},"The Basic ")]),s("li",null,[s("a",{href:"#watch-for-ref"},"Watch for Ref ")]),s("li",null,[s("a",{href:"#watch-deeply"},"Watch Deeply ")])])]),s("li",null,[s("a",{href:"#lifecycles"},"Lifecycles ")]),s("li",null,[s("a",{href:"#take-away"},"Take Away ")])])])]),s("p",null,[s("a",{href:"https://twitter.com/antfu7/status/1298667080804233221",target:"_blank",rel:"noopener"},"As you probably know"),a(", the things I excited most in Vue 3 are the "),s("a",{href:"https://v3.vuejs.org/guide/composition-api-introduction.html",target:"_blank",rel:"noopener"},"Composition API"),a(" and the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html",target:"_blank",rel:"noopener"},"reactivity system"),a(". With the Composition API we can reuse logics and states across components or even apps. Whatâ€™s better? The underhood reactivity system is decoupled from Vue, which means you can use it almost everywhere, even without UI.")]),s("p",null,"Here are some proof of concepts for using the reactivity system outside of Vue:"),s("ul",null,[s("li",null,[s("p",null,[s("a",{href:"https://github.com/yyx990803/vue-lit",target:"_blank",rel:"noopener"},[s("code",null,"@vue/lit")]),a(" is a minimal framework wrote by Evan combining "),s("a",{href:"https://github.com/vuejs/core/tree/main/packages/reactivity",target:"_blank",rel:"noopener"},[s("code",null,"@vue/reactivity")]),a(" and "),s("a",{href:"https://lit-html.polymer-project.org/",target:"_blank",rel:"noopener"},[s("code",null,"lit-html")]),a(". It can run directly in browsers, with the almost identical experience as Vue Composition API.")])]),s("li",null,[s("p",null,[s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),a(" ports Vue Composition API to React. It also provides Reactâ€™s lifecycles in the Vue style.")])])]),s("p",null,[a("Furthermore, you can even use Vueâ€™s libraries in them. Tested with "),s("a",{href:"https://github.com/antfu/vueuse",target:"_blank",rel:"noopener"},[s("code",null,"VueUse")]),a(" and "),s("a",{href:"https://github.com/posva/pinia",target:"_blank",rel:"noopener"},[s("code",null,"pinia")]),a(" in "),s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),a(", and they just work. You can find "),s("a",{href:"https://github.com/antfu/reactivue#using-vues-libraries",target:"_blank",rel:"noopener"},"more details and examples here"),a(".")]),s("p",null,[a("I am also experimenting more possibility of Vue reactivity in other scenarios, for example "),s("a",{href:"https://twitter.com/antfu7/status/1305313110903779330?s=20",target:"_blank",rel:"noopener"},"reactive file system"),a(", in a project called "),s("code",null,"tive"),a(". Itâ€™s currently a WIP private repo, but keep tuned, I get more to come ðŸ˜‰!")]),s("h2",{id:"understanding-vue-reactivity",tabindex:"-1"},[a("Understanding "),s("code",null,"@vue/reactivity"),a(),s("a",{class:"header-anchor",href:"#understanding-vue-reactivity","aria-hidden":"true"},"#")]),s("p",null,[a('"reactive objects" returned by '),s("code",null,"ref()"),a(" or "),s("code",null,"reactive()"),a(" are actually "),s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener"},"Proxies"),a(". Those proxies will trigger some actions to track the changes on properties accessing or writing.")]),s("p",null,"For a simplified example,"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"reactive"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," new "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"Proxy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  get"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"prop"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"receiver"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    track"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"prop"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," Reflect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"get"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"(..."),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"arguments"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") "),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"// get the original data")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  set"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"key"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"receiver"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    trigger"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"target"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"key"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," Reflect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"set"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"(..."),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"arguments"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") "),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"// set the original data")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"})")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"obj"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," reactive"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  hello"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"world"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"})")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"console"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"log"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"obj"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"hello"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // `track()` get called")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"obj"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"hello"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"vue"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // `trigger()` get called")]),a(`
`),s("span",{class:"line"})])]),s("p",null,"So in this way, vue can be notified when those properties get accessed or when they be modified."),s("blockquote",null,[s("p",null,[a("For more detailed explanations, check out the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html#what-is-reactivity",target:"_blank",rel:"noopener"},"official docs")])]),s("h3",{id:"computed",tabindex:"-1"},[a("Computed "),s("a",{class:"header-anchor",href:"#computed","aria-hidden":"true"},"#")]),s("p",null,[a("Since we are able to know those events, we can start diving into the "),s("code",null,"computed"),a(' which is where the "reactive" magic start shining.')]),s("p",null,[s("code",null,"computed"),a(" is like a getter that auto collects the reactive dependencies source and auto re-evaluate when they get changed.")]),s("p",null,"For example,"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"counter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," ref"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}},"1"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"multiplier"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," ref"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}},"2"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"result"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," computed"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"(()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," counter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," * "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"multiplier"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"console"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"log"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"result"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // 2")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"counter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," +="),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}}," 1")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"console"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"log"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"result"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // 4")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("To know how the "),s("code",null,"computed"),a(" work, we need to dig into the lower level API "),s("code",null,"effect"),a(" first.")]),s("h2",{id:"effect",tabindex:"-1"},[a("Effect "),s("a",{class:"header-anchor",href:"#effect","aria-hidden":"true"},"#")]),s("p",null,[s("code",null,"effect"),a(' is a new API introduced in Vue 3. Underneath, itâ€™s the engine powers the "reactivity" in '),s("code",null,"computed"),a(" and "),s("code",null,"watch"),a(". For the most of the time, you donâ€™t need to directly use it. But knowing it well helps you understand the reactivity system much easier.")]),s("p",null,[s("code",null,"effect"),a(" takes the first argument as the "),s("code",null,"getter"),a(" and a second argument for the options. The "),s("code",null,"getter"),a(" is the function that collect its deps on each run via their "),s("code",null,"track()"),a(" hooks. The field "),s("code",null,"scheduler"),a(" in options provides a way to invoke a custom function when the deps change.")]),s("p",null,[a("So basically, you can write a simple "),s("code",null,"computed"),a(" on your own like:")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"computed"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  let "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  let "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"dirty"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}}," true")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," effect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    lazy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"true"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    scheduler"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"      dirty"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," = "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"true"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // deps changed")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  })")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"  // return should be a `Ref` in real world, simplified here")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  return"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    get"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"      if"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"dirty"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"        value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," = "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() "),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"// re-evaluate")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"        dirty"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," = "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"false")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"      }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"      return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("If you really interested in how it works in Vue, check out "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/computed.ts",target:"_blank",rel:"noopener"},"the source code here")]),s("h2",{id:"build-yourself-a-watch",tabindex:"-1"},[a("Build yourself a "),s("code",null,"watch"),a(),s("a",{class:"header-anchor",href:"#build-yourself-a-watch","aria-hidden":"true"},"#")]),s("p",null,[a("We have done the most important APIs in "),s("code",null,"@vue/reactivity"),a(" now, which is "),s("code",null,"ref"),a(),s("code",null,"reactive"),a(),s("code",null,"effect"),a(),s("code",null,"computed"),a(".")]),s("p",null,[a("Oh wait, we are missing the "),s("code",null,"watch"),a(" here!")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"import"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," }"),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}}," from"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"@vue/reactivity"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // does NOT exist!")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("If you take a look at Vue 3â€™s source code, you will find that "),s("code",null,"watch"),a(" is actually "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/runtime-core/src/apiWatch.ts",target:"_blank",rel:"noopener"},[a("implemented in "),s("code",null,"@vue/runtime-core")]),a(", along with the Vueâ€™s component model and lifecycles. The main reason for this is that "),s("code",null,"watch"),a(" is deep bound with the componentâ€™s lifecycles (auto dispose, invalidate, etc.). But it shouldnâ€™t be the thing to keep you from using it outside of Vue.")]),s("p",null,[a("Letâ€™s implement the "),s("code",null,"watch"),a(" our own!")]),s("h3",{id:"the-basic",tabindex:"-1"},[a("The Basic "),s("a",{class:"header-anchor",href:"#the-basic","aria-hidden":"true"},"#")]),s("p",null,"Letâ€™s take a look at Vueâ€™s watch interface first"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"count"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," ref"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}},"0"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"(")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," count"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"newValue"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"    console"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"log"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"`"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"count changed to: "),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"${"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"newValue"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"!"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"`"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"count"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}}," 2")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"// count changed to: 2!")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("With the knowledge of "),s("code",null,"effect"),a(", itâ€™s quite straight forward to implement")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," fn"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," effect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    lazy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"true"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    scheduler"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"fn")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"  // a callback function is returned to stop the effect")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  return"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," stop"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("p",null,"Watch is lazy by default in Vue, you can add the third options to give control to the users."),s("h3",{id:"watch-for-ref",tabindex:"-1"},[a("Watch for Ref "),s("a",{class:"header-anchor",href:"#watch-for-ref","aria-hidden":"true"},"#")]),s("p",null,[a("You may also notice that the Vueâ€™s "),s("code",null,"watch"),a(" also allows passing the ref directly to it.")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"(")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  count"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," /* onChanged */"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"})])]),s("p",null,"For that, just wrap it into a getter will do"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," fn"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," isRef"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    ? "),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    : "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," effect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    lazy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"true"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    scheduler"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"fn")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  return"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," stop"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("h3",{id:"watch-deeply",tabindex:"-1"},[a("Watch Deeply "),s("a",{class:"header-anchor",href:"#watch-deeply","aria-hidden":"true"},"#")]),s("p",null,[a("One other great feature about "),s("code",null,"watch"),a(" is that it allows you to watch on deep changes.")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"state"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," reactive"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  info"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Anthony"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"})")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"state"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," console"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"log"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"changed!"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," },"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," { "),s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"true"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," })")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"state"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"info"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Anthony Fu"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"// changed!")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("To implement this feature, you need to collect the "),s("code",null,"track()"),a(" events on every nested property. We can achieve that with a "),s("code",null,"traverse"),a(" function.")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"function"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," traverse"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," seen"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," new"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," Set"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"())"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  if"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"!"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"isObject"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," ||"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," seen"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"has"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"))")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," value")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  seen"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"add"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // prevent circular reference ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  if"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"isArray"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"))"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    for"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"let "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"i"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}}," 0"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},";"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," i"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," <"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"length"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},";"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," i"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"++"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      traverse"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"["),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"i"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"],"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," seen"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  else"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    for"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"key"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," of"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," Object"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"keys"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"))")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      traverse"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"["),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"key"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"],"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," seen"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"watch"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," fn"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," lazy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}}," true"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," })"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  let "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," isRef"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    ? "),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    : "),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"isReactive"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"      ? "),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," source")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"      : "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"source")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  if"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," traverse"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"())")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    ")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"  const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," effect"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"getter"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"    lazy"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    scheduler"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"fn")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  return"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," stop"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"runner"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("Done! The thing left to do is to polish, adding overloads to make it more flexible, add more options to get better control, and handle some edge cases. Then you should get yourself a good start for using a custom "),s("code",null,"watch"),a("!")]),s("h2",{id:"lifecycles",tabindex:"-1"},[a("Lifecycles "),s("a",{class:"header-anchor",href:"#lifecycles","aria-hidden":"true"},"#")]),s("p",null,[a("In Vue, "),s("code",null,"computed"),a(" and "),s("code",null,"watch"),a(" will automatically bind their "),s("code",null,"effect"),a(" runner to the current component instance. When the component get unmounted, the effects bond to it will be auto disposed. More specially, you can read "),s("a",{href:"https://github.com/vuejs/core/blob/985bd2bcb5fd8bccd1c15c8c5d89a6919fd73922/packages/runtime-core/src/apiWatch.ts#L294",target:"_blank",rel:"noopener"},"the source code here"),a(".")]),s("p",null,"Since we donâ€™t have an instance, if you want to stop those effects, you have to do them manually. When you have multiple effects in used, to stop them together, you have to manually collect them together. One easier way is to mock similar lifecycles like Vue. This requires some amount of works, I will explain that in another blog post. Please keep tuned."),s("h2",{id:"take-away",tabindex:"-1"},[a("Take Away "),s("a",{class:"header-anchor",href:"#take-away","aria-hidden":"true"},"#")]),s("p",null,[a("Thanks for reading! And hope it is helpful for you to understand and better play with the Vue reactivity system. If you want to have the "),s("code",null,"watch"),a(" outside of Vue, I made one for you (much more robust than the examples above for sure).")]),s("pre",{class:"block language-bash"},[a("npm i "),s("a",{href:"https://github.com/antfu/vue-reactivity-watch",target:"_blank"},"@vue-reactivity/watch"),a(`
`)]),s("p",null,"Have fun ;P")],-1),h={__name:"watch-with-reactivity",setup(p){const e={title:"Watch with @vue/reactivity",description:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own.",date:"2020-09-18T00:00:00.000Z",lang:"en",duration:"12min",image:"https://antfu.me/og/watch-with-reactivity.png",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{name:"twitter:title",content:"Watch with @vue/reactivity"},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"twitter:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]};return o({title:"Watch with @vue/reactivity",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{name:"twitter:title",content:"Watch with @vue/reactivity"},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"twitter:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]}),(y,k)=>{const l=t;return c(),r(l,{frontmatter:e},{default:n(()=>[d]),_:1})}}};export{h as default};
