import{u as n,c as e,w as r,_ as t,o as c,a as s,d as a}from"./app-b266d4ec.js";const p=s("div",{class:"prose m-auto slide-enter-content"},[s("p",null,[s("div",{class:"table-of-contents"},[s("div",{class:"table-of-contents-anchor"},[s("div",{class:"i-ri-menu-2-fill"})]),s("ul",null,[s("li",null,[s("a",{href:"#type-for-this"},"Type for this "),s("ul",null,[s("li",null,[s("a",{href:"#thistype"},"ThisType ")])])])])])]),s("p",null,[a("As you may or may not know, I am working on preparing to release the v1.0 version for "),s("a",{href:"https://github.com/vuejs/composition-api",target:"_blank",rel:"noopener"},"@vue/composition-api"),a(" recently. One of the current problems is that the type inference does not play well "),s("a",{href:"https://github.com/vuejs/composition-api/issues/338",target:"_blank",rel:"noopener"},"#338"),a(". So I get a chance to have a deeper look at "),s("a",{href:"https://github.com/vuejs/composition-api",target:"_blank",rel:"noopener"},"vue-next"),a("’s type implementations. I will tell you what I learned and how magic works in Vue.")]),s("p",null,[a("Forget about the "),s("code",null,"setup()"),a(" function and "),s("code",null,"Composition API"),a(" for now, let talk about the options API in Vue 2 that everybody familiar with. In a classical example, we would have "),s("code",null,"data"),a(", "),s("code",null,"computed"),a(", "),s("code",null,"methods"),a(" and some other fields like this:")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"export"),s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}}," default"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  data"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},":"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    first_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},":"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Anthony"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    last_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},":"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Fu"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  computed"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},":"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    full_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"      return"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," `"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"${"),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"first_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ${"),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"last_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"`")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},":"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    hi"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"()"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      alert"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"full_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("It works well in JavaScript and putting all the context into "),s("code",null,"this"),a(" is pretty straightforward and easy to understand. But when you switch to TypeScript for static type checking. "),s("code",null,"this"),a(" will not be the context you expected. How can we make the types work for Vue like the example above?")]),s("h2",{id:"type-for-this",tabindex:"-1"},[a("Type for "),s("code",null,"this"),a(),s("a",{class:"header-anchor",href:"#type-for-this","aria-hidden":"true"},"#")]),s("p",null,[a("To explicitly assign the type to "),s("code",null,"this"),a(", we can simply use the "),s("code",null,"this parameter"),a(":")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"interface"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Context"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  $injected"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"string")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"function"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," bar"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Context"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"  this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"$injected"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"})])]),s("p",null,"The limitation of this approach is that we will lose the signature of the method when working with a dict of methods:"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"type"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Record"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"string"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ("),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Context"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ..."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"args"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"any"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"[])"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," =>"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," any"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  bar"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"    this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"$injected"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"bar"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"foo"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," '"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"bar"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // no error, the type of arguments becomes `any[]`")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("We would not want to ask users to explicitly type "),s("code",null,"this"),a(" in every method in order to make the type checking works. So we will need another approach.")]),s("h3",{id:"thistype",tabindex:"-1"},[s("a",{href:"https://www.typescriptlang.org/docs/handbook/utility-types.html#thistypet",target:"_blank",rel:"noopener"},[s("code",null,"ThisType")]),a(),s("a",{class:"header-anchor",href:"#thistype","aria-hidden":"true"},"#")]),s("p",null,[a("After digging into Vue’s code, I found an interesting TypeScirpt utility "),s("code",null,"ThisType"),a(". The official doc says:")]),s("blockquote",null,[s("p",null,[a("This utility does not return a transformed type. Instead, it serves as a marker for a contextual "),s("code",null,"this"),a(" type.")])]),s("p",null,[s("code",null,"ThisType"),a(" would affect all the nested functions. With it, we can have:")]),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"interface"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  double"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") => "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"    nested"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      half"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": ("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") => "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"const "),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," & "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"ThisType"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," & "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Context"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"> ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  double"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"    this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"$injected"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," a"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," *"),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}}," 2")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"    nested"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      half"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"a"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"number"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"        this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"$injected"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"        return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," a"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," /"),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}}," 2")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"      }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"double"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}},"2"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"double"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"foo"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // error")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"deep"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"nested"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"half"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#2F798A","--s-dark":"#4C9A91"}},"4"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"})])]),s("p",null,"The typing works well, but it still requires users to define the type interface of Methods first. Can we make it infer itself automatically?"),s("p",null,"We can do that with function inference:"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"type"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  methods"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"?"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," &"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," ThisType"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," &"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Context"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"function"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," define"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">)"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"  return"),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}}," options")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"define"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    foo"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"      this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"$injected"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // ok")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"})")]),a(`
`),s("span",{class:"line"})])]),s("p",null,[a("There is only one step left, to make context object dynamic inference from "),s("code",null,"data"),a(" and "),s("code",null,"computed"),a(".")]),s("p",null,"The full working demo would be:"),s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark",style:{"background-color":"#ffffff","--s-dark-bg":"#121212",color:"#393a34","--s-dark":"#dbd7caee"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"/* ---- Type ---- */")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"export"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," type"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," ExtractComputedReturns"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," extends"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," any"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  ["),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"key"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," in"),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}}," keyof"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"]: "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"T"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"["),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"key"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"] "),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"extends"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," (..."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"args"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"any"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"[]) => "),s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"infer"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," TReturn")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    ?"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," TReturn")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"    :"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," never")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"type"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," Options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"D"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {},"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," C"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {},"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," M"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {}>"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ="),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  data"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": () => "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"D")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  computed"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"C")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"  methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"M")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  mounted"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": () => "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"void")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"  // and other options")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"&"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," ThisType"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"D"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," &"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," M"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," &"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," ExtractComputedReturns"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"C"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">>"),s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}}," // merge them together")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959","--s-dark":"#CB7676"}},"function"),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}}," define"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"D"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," C"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},","),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}}," M"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"Options"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"<"),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"D"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"C"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},", "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"M"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},">)"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0","--s-dark":"#758575DD"}},"/* ---- Usage ---- */")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"define"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"({")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  data"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"    return"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"      first_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Anthony"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"      last_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"Fu"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"'"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},",")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  computed"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    fullname"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F","--s-dark":"#4D9375"}},"      return"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}}," `"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"${"),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"first_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#999999","--s-dark":"#666666"}}," ${"),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B56959","--s-dark":"#C98A7D"}},"last_name"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"}"),s("span",{style:{color:"#B5695999","--s-dark":"#C98A7D99"}},"`")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#998418","--s-dark":"#B8A965"}},"  methods"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"    notify"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"msg"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},": "),s("span",{style:{color:"#2E8F82","--s-dark":"#5DA994"}},"string"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"      alert"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"msg"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"    }")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"  mounted"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"() {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"    this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#59873A","--s-dark":"#80A665"}},"notify"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"("),s("span",{style:{color:"#A65E2B","--s-dark":"#C99076"}},"this"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},"."),s("span",{style:{color:"#B07D48","--s-dark":"#BD976A"}},"fullname"),s("span",{style:{color:"#999999","--s-dark":"#666666"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"  },")]),a(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999","--s-dark":"#666666"}},"})")]),a(`
`),s("span",{class:"line"})])])],-1),D={__name:"type-inferencing-in-vue",setup(d){const l={title:"Type Inferencing in Vue",date:"2020-06-28T00:00:00.000Z",lang:"en",image:"https://antfu.me/og/type-inferencing-in-vue.png",meta:[{property:"og:title",content:"Type Inferencing in Vue"},{name:"twitter:title",content:"Type Inferencing in Vue"},{property:"og:image",content:"https://antfu.me/og/type-inferencing-in-vue.png"},{name:"twitter:image",content:"https://antfu.me/og/type-inferencing-in-vue.png"},{name:"twitter:card",content:"summary_large_image"}]};return n({title:"Type Inferencing in Vue",meta:[{property:"og:title",content:"Type Inferencing in Vue"},{name:"twitter:title",content:"Type Inferencing in Vue"},{property:"og:image",content:"https://antfu.me/og/type-inferencing-in-vue.png"},{name:"twitter:image",content:"https://antfu.me/og/type-inferencing-in-vue.png"},{name:"twitter:card",content:"summary_large_image"}]}),(k,i)=>{const o=t;return c(),e(o,{frontmatter:l},{default:r(()=>[p]),_:1})}}};export{D as default};
